<!DOCTYPE html>

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Sample_Annot.bas</title><link rel="stylesheet" type="text/css" href="../styles/main.css" /><script type="text/javascript" src="../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.2 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Functions"></a><a name="Topic35"></a><div class="CTopic TGroup LExcelVBA first">
 <div class="CTitle">Functions</div>
</div>

<a name="Autofill_Column_By_QC_Sample_Type"></a><a name="Topic59"></a><div class="CTopic TFunction LExcelVBA">
 <div class="CTitle">Autofill_Column_By_QC_Sample_Type</div>
 <div class="CBody"><div class="CHeading">Description</div><p>Fill in the column indicated by Header_Name with the value indicated by Autofill_Value on rows whose sample type matches Sample_Type</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">Sample_Type As String</td><td class="CDLDefinition"><p>Name of the QC Sample Type to match like SPL or BQC. To choose all sample types, the input is All Sample Types</p></td></tr><tr><td class="CDLEntry">Header_Name As String</td><td class="CDLDefinition"><p>Name of the column to fill in. Currently, we only use &quot;Sample Amount&quot;, &quot;Sample_Amount_Unit&quot; and &quot;ISTD_Mixture_Volume_[uL]&quot;</p></td></tr><tr><td class="CDLEntry">Autofill_Value As String</td><td class="CDLDefinition"><p>Value to fill in at column &quot;Header_Name on rows whose sample type matches Sample_Type</p></td></tr></table><div class="CHeading">Examples</div><pre class="CCode"><span class="SHString">' Get the Sample_Annot worksheet from the active workbook</span><br /><span class="SHString">'</span> The SampleAnnotSheet is a code name<br /><span class="SHString">' Refer to https://riptutorial.com/excel-vba/example/11272/worksheet--name---index-or--codename</span><br /><span class="SHString">Dim Sample_Annot_Worksheet As Worksheet</span><br /><br /><span class="SHString">If Utilities.Check_Sheet_Code_Name_Exists(ActiveWorkbook, &quot;SampleAnnotSheet&quot;) = False Then</span><br /><span class="SHString">    MsgBox (&quot;Sheet Sample_Annot is missing&quot;)</span><br /><span class="SHString">    Application.EnableEvents = True</span><br /><span class="SHString">    Exit Sub</span><br /><span class="SHString">End If</span><br /><br /><span class="SHString">Set Sample_Annot_Worksheet = Utilities.Get_Sheet_By_Code_Name(ActiveWorkbook, &quot;SampleAnnotSheet&quot;)</span><br /><br /><span class="SHString">Sample_Annot_Worksheet.Activate</span><br /><br /><span class="SHString">Dim Sample_Amount_Array() As String</span><br /><span class="SHString">Dim ISTD_Mixture_Volume_uL_Array() As String</span><br /><br /><span class="SHString">Dim QC_Sample_Type_Array(4) As String</span><br /><span class="SHString">QC_Sample_Type_Array(0) = &quot;SPL&quot;</span><br /><span class="SHString">QC_Sample_Type_Array(1) = &quot;BQC&quot;</span><br /><span class="SHString">QC_Sample_Type_Array(2) = &quot;TQC&quot;</span><br /><span class="SHString">QC_Sample_Type_Array(3) = &quot;TQC&quot;</span><br /><span class="SHString">QC_Sample_Type_Array(4) = &quot;BQC&quot;</span><br /><br /><span class="SHString">Utilities.Load_To_Excel Data_Array:=QC_Sample_Type_Array, _</span><br /><span class="SHString">                        HeaderName:=&quot;Sample_Type&quot;, _</span><br /><span class="SHString">                        HeaderRowNumber:=1, _</span><br /><span class="SHString">                        DataStartRowNumber:=2, _</span><br /><span class="SHString">                        MessageBoxRequired:=False</span><br /><br /><span class="SHString">Autofill_Column_By_QC_Sample_Type Sample_Type:=&quot;BQC&quot;, _</span><br /><span class="SHString">                                  Header_Name:=&quot;Sample_Amount&quot;, _</span><br /><span class="SHString">                                  Autofill_Value:=&quot;10&quot;</span><br /><br /><span class="SHString">Autofill_Column_By_QC_Sample_Type Sample_Type:=&quot;All Sample Types&quot;, _</span><br /><span class="SHString">                                  Header_Name:=&quot;ISTD_Mixture_Volume_[uL]&quot;, _</span><br /><span class="SHString">                                  Autofill_Value:=&quot;190</span></pre></div>
</div>

<a name="Create_New_Sample_Annot_Tidy"></a><a name="Topic60"></a><div class="CTopic TFunction LExcelVBA">
 <div class="CTitle">Create_New_Sample_Annot_Tidy</div>
 <div class="CBody"><div class="CHeading">Description</div><p>Create Sample Annotation from an input data file in tabular form and output them into the Sample_Annot sheet. The columns filled will be</p><ul><li><p>Data_File_Name</p></li><li><p>Merge_Status</p></li><li><p>Sample_Name</p></li><li><p>Sample_Type</p></li></ul><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">TidyDataFiles As String</td><td class="CDLDefinition"><p>File path to a tabular/tidy data file.&nbsp; If multiple files are required, the different file path must be separated by &quot;;&quot; Eg. {FilePath 1};{FilePath 2}</p></td></tr><tr><td class="CDLEntry">DataFileType As String</td><td class="CDLDefinition"><p>File type of the input tabular/tidy data file</p></td></tr><tr><td class="CDLEntry">TransitionProperty As String</td><td class="CDLDefinition"><p>Choose &quot;Read as column variables&quot; if transition names are the column name.&nbsp; Choose &quot;Read as row observations&quot; if transition names are row entries.</p></td></tr><tr><td class="CDLEntry">StartingRowNum As Integer</td><td class="CDLDefinition"><p>Starting row number to read the tabular data</p></td></tr><tr><td class="CDLEntry">StartingColumnNum As Integer</td><td class="CDLDefinition"><p>Starting column number to read the tabular data</p></td></tr></table><div class="CHeading">Examples</div><pre class="CCode">Dim TestFolder As String<br />Dim TidyDataColumnFiles As String<br /><br />TestFolder = ThisWorkbook.Path &amp; <span class="SHString">&quot;\Testdata\&quot;</span><br /><span class="SHString">TidyDataColumnFiles = TestFolder &amp; &quot;</span>TidySampleColumn.csv<span class="SHString">&quot;</span><br /><br /><span class="SHString">Sample_Annot.Create_New_Sample_Annot_Tidy TidyDataFiles:=TidyDataColumnFiles, _</span><br /><span class="SHString">                                          DataFileType:=&quot;</span>csv<span class="SHString">&quot;, _</span><br /><span class="SHString">                                          SampleProperty:=&quot;</span>Read as column variables<span class="SHString">&quot;, _</span><br /><span class="SHString">                                          StartingRowNum:=1, _</span><br /><span class="SHString">                                          StartingColumnNum:=2</span></pre></div>
</div>

<a name="Create_New_Sample_Annot_Raw"></a><a name="Topic61"></a><div class="CTopic TFunction LExcelVBA">
 <div class="CTitle">Create_New_Sample_Annot_Raw</div>
 <div class="CBody"><div class="CHeading">Description</div><p>Create Sample Annotation from an input raw data file and output them into the Sample_Annot sheet. The columns filled will be</p><ul><li><p>Data_File_Name</p></li><li><p>Merge_Status</p></li><li><p>Sample_Name</p></li><li><p>Sample_Type</p></li></ul><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">RawDataFiles As String</td><td class="CDLDefinition"><p>File path to a Raw Data (Agilent) File in csv.&nbsp; If multiple files are required, the different file path must be separated by &quot;;&quot; Eg. {FilePath 1};{FilePath 2}</p></td></tr></table><div class="CHeading">Examples</div><pre class="CCode">Dim TestFolder As String<br />Dim RawDataFiles As String<br /><br />TestFolder = ThisWorkbook.Path &amp; <span class="SHString">&quot;\Testdata\&quot;</span><br /><span class="SHString">RawDataFiles = TestFolder &amp; &quot;</span>AgilentRawDataTest1.csv<span class="SHString">&quot;</span><br /><br /><span class="SHString">Sample_Annot.Create_New_Sample_Annot_Raw RawDataFiles:=RawDataFiles</span></pre></div>
</div>

<a name="Merge_With_Sample_Annot"></a><a name="Topic62"></a><div class="CTopic TFunction LExcelVBA">
 <div class="CTitle">Merge_With_Sample_Annot</div>
 <div class="CBody"><div class="CHeading">Description</div><p>Merge the an input raw data file with a user input sample annotation file. The merged data is then outputted into the Sample_Annot sheet. The columns filled will be</p><ul><li><p>Data_File_Name</p></li><li><p>Merge_Status</p></li><li><p>Sample_Name</p></li><li><p>Sample_Type</p></li></ul><p>It is also possible to fill in the these columns if the user's input sample annotation file provides these information.</p><ul><li><p>Sample_Amount</p></li><li><p>ISTD_Mixture_Volume_[uL]</p></li></ul><p>Should there be any issues with the merge, a message box will appear.</p><div class="CImage"><a href="../images/Sample_Annot_Merge_Issues.png" target="_blank" class="ZoomLink"><img src="../images/Sample_Annot_Merge_Issues.png" loading="lazy" class="KnownDimensions" width="487" height="177" style="max-width: 487px" alt="Sample_Annot_Merge_Issues" /></a></div><p>Users are encouraged to see the Merge_Status column to see what is wrong.</p><div class="CImage"><a href="../images/Sample_Annot_Merge_Issue_Details.png" target="_blank" class="ZoomLink"><img src="../images/Sample_Annot_Merge_Issue_Details.png" loading="lazy" class="KnownDimensions" width="1207" height="124" style="max-width: 1207px" alt="Sample_Annot_Merge_Issue_Details" /></a></div><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">RawDataFiles As String</td><td class="CDLDefinition"><p>File path to a Raw Data (Agilent) File in csv.&nbsp; If multiple files are required, the different file path must be separated by &quot;;&quot; Eg. {FilePath 1};{FilePath 2}</p></td></tr><tr><td class="CDLEntry">SampleAnnotFile As String</td><td class="CDLDefinition"><p>File path to a user input sample annotation file in csv.</p></td></tr></table><pre class="CCode">Dim TestFolder As String<br />Dim RawDataFiles As String<br />Dim SampleAnnotFile As String<br /><br />TestFolder = ThisWorkbook.Path &amp; <span class="SHString">&quot;\Testdata\&quot;</span><br /><span class="SHString">RawDataFiles = TestFolder &amp; &quot;</span>AgilentRawDataTest1.csv<span class="SHString">&quot;</span><br /><span class="SHString">SampleAnnotFile = TestFolder &amp; &quot;</span>Sample_Annotation_Example.csv<span class="SHString">&quot;</span><br /><br /><span class="SHString">Sample_Annot.Merge_With_Sample_Annot RawDataFiles:=RawDataFiles, _</span><br /><span class="SHString">                                     SampleAnnotFile:=SampleAnnotFile</span></pre></div>
</div>

<a name="Get_Sample_Name_Array_From_Annot_File"></a><a name="Topic105"></a><div class="CTopic TFunction LExcelVBA">
 <div class="CTitle">Get_Sample_Name_Array_From_Annot_File</div>
 <div class="CBody"><div class="CHeading">Description</div><p>Get an array of Sample Names from a given sample annotation file in csv and tabular form.</p><p>If the sample names ends with .d, we will remove the .d.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">xFileName As String</td><td class="CDLDefinition"><p>File path to a Sample Annotation File in csv.</p></td></tr></table><div class="CHeading">Returns</div><p>A string array of Sample Names.</p><div class="CHeading">Examples</div><pre class="CCode">Load_Sample_Annot_Raw.Sample_Name_Text.Text = <span class="SHString">&quot;Sample&quot;</span><br />Load_Sample_Annot_Raw.Is_Column_Name_Present.Value = True<br /><br /><span class="SHString">'Load the Sample_Name from Sample Annotation</span><br /><br /><span class="SHString">Dim SampleAnnotFile As String</span><br /><span class="SHString">Dim TestFolder As String</span><br /><span class="SHString">Dim Sample_Name_Array_from_Sample_Annot() As String</span><br /><br /><span class="SHString">TestFolder = ThisWorkbook.Path &amp; &quot;\Testdata\&quot;</span><br /><span class="SHString">SampleAnnotFile = TestFolder &amp; &quot;Sample_Annotation_Example.csv&quot;</span><br /><br /><span class="SHString">Sample_Name_Array_from_Sample_Annot = Sample_Annot.Get_Sample_Name_Array_From_Annot_File(SampleAnnotFile)</span></pre></div>
</div>

<a name="Get_Sample_Column_Name_Position_From_Annot_File"></a><a name="Topic106"></a><div class="CTopic TFunction LExcelVBA">
 <div class="CTitle">Get_Sample_Column_Name_Position_From_Annot_File</div>
 <div class="CBody"><div class="CHeading">Description</div><p>Get the column position where the &quot;Sample Name&quot; column is located as indicated in the Sample_Name text box.</p><p>In the case when the input sample annotation file has headers, it will look like this.</p><div class="CImage"><a href="../images/Sample_Annot_Merge_Sample_Name_With_Headers.png" target="_blank" class="ZoomLink"><img src="../images/Sample_Annot_Merge_Sample_Name_With_Headers.png" loading="lazy" class="KnownDimensions" width="910" height="568" style="max-width: 910px" alt="Sample_Annot_Merge_Sample_Name_With_Headers" /></a></div><p>In the case when the input sample annotation file has headers, it will look like this.</p><div class="CImage"><a href="../images/Sample_Annot_Merge_Sample_Name_No_Headers.png" target="_blank" class="ZoomLink"><img src="../images/Sample_Annot_Merge_Sample_Name_No_Headers.png" loading="lazy" class="KnownDimensions" width="877" height="557" style="max-width: 877px" alt="Sample_Annot_Merge_Sample_Name_No_Headers" /></a></div><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">first_line() As String</td><td class="CDLDefinition"><p>A string array of column names or the first row of the input sample annotation file.</p></td></tr></table><div class="CHeading">Returns</div><p>An integer indicating where &quot;Sample Name&quot; column is located as indicated in the Sample_Name text box.</p><div class="CHeading">Examples</div><pre class="CCode"><span class="SHString">'Load the Sample_Name from Sample Annotation</span><br /><br /><span class="SHString">Dim first_line(4) As String</span><br /><br /><span class="SHString">first_line(0) = &quot;Sample&quot;</span><br /><span class="SHString">first_line(1) = &quot;ID&quot;</span><br /><span class="SHString">first_line(2) = &quot;TimePoint&quot;</span><br /><span class="SHString">first_line(3) = &quot;Cell Number&quot;</span><br /><span class="SHString">first_line(4) = &quot;ISTD Volume&quot;</span><br /><br /><span class="SHString">Load_Sample_Annot_Raw.Sample_Name_Text.Text = &quot;Sample&quot;</span><br /><span class="SHString">Load_Sample_Annot_Raw.Is_Column_Name_Present.Value = True</span><br /><br /><span class="SHString">'</span>Get the data starting row and the right column <span class="SHKeyword">for</span> the Sample Name<br />Dim Sample_Column_Name_pos As Integer<br />Sample_Column_Name_pos = Sample_Annot.Get_Sample_Column_Name_Position_From_Annot_File(first_line)</pre></div>
</div>

<a name="Get_Sample_Annot_Starting_Line_From_Annot_File"></a><a name="Topic107"></a><div class="CTopic TFunction LExcelVBA">
 <div class="CTitle">Get_Sample_Annot_Starting_Line_From_Annot_File</div>
 <div class="CBody"><div class="CHeading">Description</div><p>Get the starting line where the data is from the annotation file.&nbsp; It should be 0 if the data has no headers and 1 if there is.&nbsp; We assume that the column names is on the first line.&nbsp; Basically, it just check if this check box is checked or not</p><div class="CImage"><a href="../images/Sample_Annot_Merge_Sample_Name_Headers_Checkbox.png" target="_blank" class="ZoomLink"><img src="../images/Sample_Annot_Merge_Sample_Name_Headers_Checkbox.png" loading="lazy" class="KnownDimensions" width="910" height="568" style="max-width: 910px" alt="Sample_Annot_Merge_Sample_Name_Headers_Checkbox" /></a></div><div class="CHeading">Returns</div><p>An integer indicating 0 if the data has no headers and 1 if there is.</p><div class="CHeading">Examples</div><pre class="CCode"><span class="SHString">'Get the data starting row</span><br /><br /><span class="SHString">Load_Sample_Annot_Raw.Is_Column_Name_Present.Value = True</span><br /><br /><span class="SHString">Dim data_starting_line As Integer</span><br /><span class="SHString">data_starting_line = Sample_Annot.Get_Sample_Annot_Starting_Line_From_Annot_File</span></pre></div>
</div>

<a name="Load_Sample_Info_To_Excel"></a><a name="Topic108"></a><div class="CTopic TFunction LExcelVBA last">
 <div class="CTitle">Load_Sample_Info_To_Excel</div>
 <div class="CBody"><div class="CHeading">Description</div><p>Output the sample information (Sample_Amount and ISTD_Mixture_Volume_[uL]) found in the sample annotation file to the Sample_Annot sheet</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">xFileName As String</td><td class="CDLDefinition"><p>File path to a Sample Annotation File in csv.</p></td></tr><tr><td class="CDLEntry">MatchingIndexArray() As String</td><td class="CDLDefinition"><p>A string array of row positions indicating which unique row in the sample annotation file matches the sample name of the input raw data.&nbsp; Sample information from these matching rows will be loaded into the Sample_Annot sheet.&nbsp; Rows that cannot be matched because it is not indicated or is repeated more than once in the sample annotation file are left as blank.</p></td></tr></table><div class="CHeading">Examples</div><pre class="CCode">Dim SampleAnnotFile As String<br />Dim TestFolder As String<br /><br />TestFolder = ThisWorkbook.Path &amp; <span class="SHString">&quot;\Testdata\&quot;</span><br /><span class="SHString">SampleAnnotFile = TestFolder &amp; &quot;</span>Sample_Annotation_Example.csv<span class="SHString">&quot;</span><br /><br /><span class="SHString">Load_Sample_Annot_Raw.Sample_Amount_Text.Text = &quot;</span>Cell Number<span class="SHString">&quot;</span><br /><span class="SHString">Load_Sample_Annot_Raw.ISTD_Mixture_Volume_Text.Text = &quot;</span>ISTD Volume<span class="SHString">&quot;</span><br /><br /><span class="SHString">Dim MatchingIndexArray(4) As String</span><br /><span class="SHString">MatchingIndexArray(0) = &quot;</span><span class="SHNumber">0</span><span class="SHString">&quot;</span><br /><span class="SHString">MatchingIndexArray(1) = &quot;</span><span class="SHNumber">1</span><span class="SHString">&quot;</span><br /><span class="SHString">MatchingIndexArray(2) = &quot;</span><span class="SHNumber">2</span><span class="SHString">&quot;</span><br /><span class="SHString">MatchingIndexArray(3) = vbNullString</span><br /><span class="SHString">MatchingIndexArray(4) = &quot;</span><span class="SHNumber">3</span><span class="SHString">&quot;</span><br /><br /><span class="SHString">Sample_Annot.Load_Sample_Info_To_Excel xFileName:=SampleAnnotFile, _</span><br /><span class="SHString">                                       MatchingIndexArray:=MatchingIndexArray</span></pre></div>
</div>

</body></html>